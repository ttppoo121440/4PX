<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>4PX</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
      integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay"
      crossorigin="anonymous"
    />
    <style>
      .search {
        background-color: #59b7c2;
        box-shadow: 0 1px 1px #ccc;
        border-radius: 2px;
        padding: 14px;
        margin: 45px auto 20px;
        margin-top: 20px;
        position: relative;
      }

      .search input {
        background: #fff no-repeat 13px 13px;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkU5NEY0RTlFMTA4NzExRTM5RTEzQkFBQzMyRjkyQzVBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkU5NEY0RTlGMTA4NzExRTM5RTEzQkFBQzMyRjkyQzVBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RTk0RjRFOUMxMDg3MTFFMzlFMTNCQUFDMzJGOTJDNUEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RTk0RjRFOUQxMDg3MTFFMzlFMTNCQUFDMzJGOTJDNUEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4DjA/RAAABK0lEQVR42pTSQUdEURjG8dOY0TqmPkGmRcqYD9CmzZAWJRHVRIa0iFYtM6uofYaiEW2SRJtEi9YxIklp07ZkWswu0v/wnByve7vm5ee8M+85zz1jbt9Os+WiGkYdYxjCOx5wgFeXUHmtBSzpcCGa+5BJTCjEP+0nKWAT8xqe4ArPGEEVC1hHEbs2oBwdXkM7mj/JLZrad437sCGHOfUtcziutuYu2v8XUFF/4f6vMK/YgAH1HxkBYV60AR31gxkBYd6xAeF3VzMCwvzOBpypX8V4yuFRzX2d2gD/l5yjH4fYQEnzkj4fae5rJulF2sMXVrAsaTWttRFu4Osb+1jEDT71/ZveyhouTch2fINQL9hKefKjuYFfuznXWzXMTabyrvfyIV3M4vhXgAEAUMs7K0J9UJAAAAAASUVORK5CYII=);
        border: none;
        width: 100%;
        line-height: 19px;
        padding: 11px 0;

        border-radius: 2px;
        box-shadow: 0 2px 8px #c4c4c4 inset;
        text-align: left;
        font-size: 14px;
        font-family: inherit;
        color: #738289;
        font-weight: bold;
        outline: none;
        text-indent: 40px;
      }
    </style>
  </head>

  <body>
    <div id="app" class="container">
      <!-- add/updata Modal -->
      <div
        class="modal fade"
        id="exampleModalLong"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalLongTitle"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5
                v-if="isnew === true"
                class="modal-title  text-primary font-weight-bold"
              >
                新增
              </h5>
              <h5 v-else class="modal-title  text-primary font-weight-bold">
                修改
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="SKU">SKU</label>
                <input
                  type="text"
                  class="form-control"
                  id="SKU"
                  placeholder="SKU"
                  v-model="tempData.SKU"
                />
              </div>
              <div class="row">
                <div class="col">
                  <div class="form-group">
                    <label for="L">L （cm）</label>
                    <input
                      type="number"
                      class="form-control"
                      id="L"
                      placeholder="L"
                      v-model="tempData.L"
                    />
                  </div>
                </div>
                <div class="col">
                  <div class="form-group">
                    <label for="W">W（cm）</label>
                    <input
                      type="number"
                      class="form-control"
                      id="W"
                      placeholder="W"
                      v-model="tempData.W"
                    />
                  </div>
                </div>
                <div class="col">
                  <div class="form-group">
                    <label for="H">H（cm）</label>
                    <input
                      type="number"
                      class="form-control"
                      id="H"
                      placeholder="H"
                      v-model="tempData.H"
                    />
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="Weighing">材积重</label>
                <input
                  type="number"
                  class="form-control"
                  id="Weighing"
                  placeholder="運算中..."
                  v-model="sum"
                  disabled
                />
              </div>
              <div class="form-group">
                <label for="unit">单位</label>
                <input
                  type="text"
                  class="form-control"
                  id="unit"
                  placeholder="unit"
                  v-model="tempData.unit"
                />
              </div>
              <div class="form-group">
                <label for="ActualWeight">实际重量</label>
                <input
                  type="number"
                  class="form-control"
                  id="ActualWeight"
                  placeholder="实际重量"
                  v-model="tempData.ActualWeight"
                />
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary mr-auto"
                data-dismiss="modal"
              >
                Close
              </button>
              <button
                v-if="isnew === true"
                type="button"
                class="btn btn-primary"
                @click="addData"
              >
                儲存
              </button>
              <button
                v-else
                type="button"
                class="btn btn-primary"
                @click="edit"
              >
                修改
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- add/updata Modal -->

      <!-- deleteModal -->
      <div
        class="modal fade"
        id="deleteModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="deleteModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header  bg-danger">
              <h5 class="modal-title text-white" id="deleteModalLabel">
                確定要刪除嗎?
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body text-center">
              <h1>{{ tempData.SKU }}</h1>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary mr-auto"
                data-dismiss="modal"
              >
                取消
              </button>
              <button
                type="button "
                class="btn btn-danger"
                @click="deleteData(tempData.uid)"
              >
                刪除
              </button>
            </div>
          </div>
        </div>
      </div>

      <h1 class="text-center my-5">4PX ({{ skuData.length }})</h1>
      <!-- <button @click="addData">addData</button> -->
      <button
        class="btn btn-primary"
        data-toggle="modal"
        data-target="#exampleModalLong"
        @click="addModal"
      >
        新增
      </button>
      <div class="search">
        <input type="text" v-model="searchProduct" placeholder="Search" />
      </div>
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">SKU</th>
            <th scope="col">L （cm）</th>
            <th scope="col">W（cm）</th>
            <th scope="col">H（cm）</th>
            <th scope="col">材积重</th>
            <th scope="col">单位</th>
            <th scope="col">实际重量</th>
            <th scope="col" class="text-center">操作</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="item in skuData" :key="item.uid">
            <td class="font-weight-bold">{{ item.SKU }}</td>
            <td>{{ item.L }}</td>
            <td>{{ item.W }}</td>
            <td>{{ item.H }}</td>
            <td
              :class="{'text-danger':item.Weighing*1>item.ActualWeight*1,'font-weight-bold':item.Weighing*1>item.ActualWeight*1,'text-primary':item.Weighing*1 ==item.ActualWeight*1,'font-weight-bold':item.Weighing*1 ==item.ActualWeight*1}"
            >
              {{ item.Weighing * 1 | rounding }}
            </td>
            <td>{{ item.unit }}</td>
            <td
              :class="{'text-danger':item.ActualWeight*1>item.Weighing*1,'font-weight-bold':item.ActualWeight*1>item.Weighing*1,'text-primary':item.Weighing*1 ==item.ActualWeight*1,'font-weight-bold':item.Weighing*1 ==item.ActualWeight*1}"
            >
              {{ item.ActualWeight * 1 | rounding }}
            </td>
            <td>
              <div class="text-center">
                <button class="btn btn-outline-info" @click="showModal(item)">
                  <i class="fas fa-edit"></i>
                </button>
                <button
                  class="btn btn-outline-danger"
                  @click="showDelete(item)"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
    <script>
      new Vue({
        el: '#app',
        data() {
          return {
            test: '4PX',
            isnew: true,
            excel: [],
            excel_data: [],
            tempData: [],
            searchProduct: ''
          };
        },
        filters: {
          rounding(value) {
            return value.toFixed(1);
          }
        },
        computed: {
          skuData() {
            const vm = this;
            return this.excel_data.filter(item => {
              return (
                item.SKU.toLowerCase().indexOf(vm.searchProduct.toLowerCase()) >
                -1
              );
            });
          },
          sum: {
            get() {
              if (
                isNaN(this.tempData.L) === false &&
                isNaN(this.tempData.W) === false &&
                isNaN(this.tempData.H) === false
              ) {
                return (this.tempData.Weighing =
                  (this.tempData.L / 100) *
                  (this.tempData.W / 100) *
                  (this.tempData.H / 100) *
                  250).toFixed(1);
              }
            },
            set(value) {
              console.log('computed setter');
            }
          }
        },
        methods: {
          addModal() {
            this.isnew = true;
            this.tempData = { unit: 'kg' };
          },
          addData() {
            const data = {
              SKU: this.tempData.SKU,
              L: this.tempData.L,
              W: this.tempData.W,
              H: this.tempData.H,
              Weighing: this.tempData.Weighing,
              unit: this.tempData.unit,
              ActualWeight: this.tempData.ActualWeight
            };
            axios
              .post('https://pxx-2bd05.firebaseio.com/4PX/4PX.json', data)
              .then(res => {
                $('#exampleModalLong').modal('hide');
                this.getData();
              });
          },
          showModal(item) {
            this.isnew = false;
            $('#exampleModalLong').modal('show');
            this.tempData = Object.assign({}, item);
          },

          edit() {
            axios
              .patch(
                `https://pxx-2bd05.firebaseio.com/4PX/4PX/${
                  this.tempData.uid
                }.json`,
                this.tempData
              )
              .then(res => {
                $('#exampleModalLong').modal('hide');
                this.getData();
              });
          },
          showDelete(item) {
            $('#deleteModal').modal('show');
            this.tempData = Object.assign({}, item);
          },
          deleteData(uid) {
            axios
              .delete(`https://pxx-2bd05.firebaseio.com/4PX/4PX/${uid}.json`)
              .then(res => {
                $('#deleteModal').modal('hide');
                this.getData();
              });
          },
          getData() {
            this.excel = [];
            this.excel_data = [];
            axios
              .get('https://pxx-2bd05.firebaseio.com/4PX/4PX.json')
              .then(res => {
                this.excel = res.data;
                Object.keys(this.excel).forEach(key => {
                  this.excel_data.push({ ...this.excel[key], uid: key });
                });
              });
          }
        },
        created() {
          this.getData();
        }
      });
    </script>
  </body>
</html>
